(()=>{"use strict";function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"970",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"850",o=window.screenLeft||window.screenX,i=window.screenTop||window.screenY,t=o+(window.innerWidth||document.documentElement.clientWidth||screen.width)/2-e/2,a=i+(window.innerHeight||document.documentElement.clientHeight||screen.height)/2-n/2,d=window.open(igd.authUrl,"newwindow","width=".concat(e,",height=").concat(n,",left=").concat(t,",top=").concat(a));d.focus&&d.focus(),Object.keys(sessionStorage).forEach((function(e){e.includes("igd_last_folder_")&&sessionStorage.removeItem(e)}))}var n,o,i;n=jQuery,o=window.ModuleBuilderModal,i={init:function(){n(".insert-file-row").after('<div class="igd-dokan"><button type="button" class="dokan-btn dokan-btn-default igd-wc-button" title="Add Files from Google Drive"><img src="'.concat(igd.pluginUrl,'/assets/images/drive.png" width="20"/><span>').concat(wp.i18n.__("Add File","integrate-google-drive"),"</span></button></div>")),n(document).on("click",".dokan-btn.igd-wc-button",i.handleDokanFileSelector),n(document).on("click",".save-upload-settings",i.saveDokanUploadSettings),n(document).on("click",".dokan-igd-settings .add-account-btn",i.handleAccountAdd),n(document).on("click",".dokan-igd-settings .remove-account",i.handleDokanAccountRemove),n(document).on("click","#igd-dokan-select-media-folders",i.selectMediaLibraryFolders),n(document).on("click",".save-media-library-settings",i.saveMediaLibrarySettings)},saveMediaLibrarySettings:function(){var e=this;wp.ajax.send("igd_save_dokan_media_library_settings",{data:{data:n("#igd-dokan-media-library-settings").serialize(),nonce:igd.nonce},beforeSend:function(){n(e).find("i").removeClass("fa-save").addClass("fa-spinner fa-spin")},success:function(e){n(".dokan-igd-media-library-ajax-response").show()},error:function(e){console.log(e)},complete:function(){n(e).find("i").removeClass("fa-spin fa-spinner").addClass("fa-save")}})},selectMediaLibraryFolders:function(){Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"igd-swal igd-module-builder-modal-container"},didOpen:function(i){var t,a=document.getElementById("igd-select-files"),d=null===(t=n("#igd_dokan_media_folders").val())||void 0===t?void 0:t.trim(),s=d&&""!==d&&'""'!==d?JSON.parse(d):[];ReactDOM.render(React.createElement(o,{initData:{folders:s},onUpdate:function(o){var i=o.folders,t=(void 0===i?[]:i).map((function(e){return{id:e.id,accountId:e.accountId,name:e.name,iconLink:e.iconLink}}));n("#igd_dokan_media_folders").val(JSON.stringify(t)),e(t),Swal.close()},onClose:function(){return Swal.close()},isSelectFiles:!0,selectionType:"folders"}),a)},willClose:function(e){var n=document.getElementById("igd-select-files");ReactDOM.unmountComponentAtNode(n)}});var e=function(e){var o=n(".media-folders");o.empty(),e.map((function(e){var n=e.id,i=e.name;o.append('\n                    <div class="folder-item" data-id="'.concat(n,'">\n                        <img src="https://drive-thirdparty.googleusercontent.com/16/type/application/vnd.google-apps.folder">\n                        ').concat(i,'\n\x3c!--                        <i class="dashicons dashicons-no-alt"></i>--\x3e\n                    </div>\n                    '))}))}},handleDokanAccountRemove:function(){var e=this;Swal.fire({title:wp.i18n.__("Are you sure?","integrate-google-drive"),text:wp.i18n.__("You won't be able to revert this!","integrate-google-drive"),icon:"warning",showCancelButton:!0,confirmButtonText:wp.i18n.__("Yes, remove it!","integrate-google-drive"),reverseButtons:!0,showLoaderOnConfirm:!0,customClass:{container:"igd-swal igd-swal-reverse"},preConfirm:function(){var o=n(e).closest(".igd-account-item").data("id");return wp.ajax.post("igd_delete_account",{id:o,nonce:igd.nonce})}}).then((function(o){o.value&&(n(e).closest(".igd-account-item").remove(),Swal.fire({title:wp.i18n.__("Removed!","integrate-google-drive"),text:wp.i18n.__("Account has been removed.","integrate-google-drive"),icon:"success",showConfirmButton:!1,timer:1500,toast:!0}))}))},handleAccountAdd:function(){e()},handleDokanFileSelector:function(e){var i=n(this).parents(".dokan-download-wrapper");Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"igd-swal igd-module-builder-modal-container"},didOpen:function(e){ReactDOM.render(React.createElement(o,{initData:{},onUpdate:function(e){var o=e.folders,t=void 0===o?[]:o,a=i.find("tbody"),d=i.find(".insert-file-row ").data("row");t.map((function(e){var o=e.id,i=e.name,t=e.type,s=e.accountId,c="https://drive.google.com/open?action=igd-wc-download&id=".concat(o,"&account_id=").concat(s,"&name=").concat(i,"&type=").concat(t),l=n(d);l.find('[name="_wc_file_names[]"]').val(i),l.find('[name="_wc_file_urls[]"]').val(c),a.append(l)})),Swal.close()},onClose:function(){return Swal.close()},isWooCommerce:"download"}),document.getElementById("igd-select-files"))},willClose:function(e){ReactDOM.unmountComponentAtNode(document.getElementById("igd-select-files"))}})},saveDokanUploadSettings:function(){var e=this;wp.ajax.send("igd_save_dokan_upload_settings",{data:{data:n("#igd-dokan-upload-settings").serialize(),nonce:igd.nonce},beforeSend:function(){n(e).find("i").removeClass("fa-save").addClass("fa-spinner fa-spin")},success:function(e){n(".dokan-igd-upload-ajax-response").show()},error:function(e){console.log(e)},complete:function(){n(e).find("i").removeClass("fa-spin fa-spinner").addClass("fa-save")}})}},n(document).ready(i.init)})();