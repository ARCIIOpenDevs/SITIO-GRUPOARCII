(()=>{"use strict";function t(t){if(t<1)return 0;var e=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,e)).toFixed(2)+" "+["Byte","KB","MB","GB","TB"][e]}function e(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode("0x"+e)})))}var n,o,a;n=jQuery,o=window.ModuleBuilderModal,a={init:function(){n(document).on("click",".igd-tutor-button",a.handleVideoSelector),n(window).on("tutor_modal_shown",(function(){n(".tutorIgdUploadAttachmentBtn").length||n(".tutorUploadAttachmentBtn").after('<button type="button" class="tutor-btn tutor-btn-outline-primary tutorIgdUploadAttachmentBtn"><span class="tutor-icon-brand-google-drive tutor-mr-8"></span><span>'.concat(wp.i18n.__("Add Attachments","tutor"),"</span></button>")),a.initAttachments()})),n(document).on("click",".tutorIgdUploadAttachmentBtn",a.handleAttachmentSelection),n(document).on("click",".tutor-igd-delete-attachment",a.deleteAttachment),n(".tutor-dashboard-setting-google-drive .remove-account").on("click",a.removeAccount);var t=document.body;new MutationObserver((function(){var t=document.querySelector('input[name="videoSource"]');t&&("Google Drive"===t.value?a.addVideoSelectBtn(t):n(".igd-tutor-button").addClass("igd-hidden"),new MutationObserver((function(){"Google Drive"===t.value?a.addVideoSelectBtn(t):n(".igd-tutor-button").addClass("igd-hidden")})).observe(t,{attributes:!0,attributeFilter:["value"]}))})).observe(t,{childList:!0,subtree:!0})},addVideoSelectBtn:function(t){if(n(".igd-tutor-button").length)n(".igd-tutor-button").removeClass("igd-hidden");else{var e=n('<button type="button" class="tutor-btn tutor-btn-outline-primary igd-tutor-button"><span class="tutor-icon-brand-google-drive tutor-mr-8"></span><span>'.concat(wp.i18n.__("Select from Google Drive","tutor"),"</span></button>"));n('[name="videoUrl"]').parent().after(e)}},removeAccount:function(){var t=this;Swal.fire({title:wp.i18n.__("Are you sure?","integrate-google-drive"),text:wp.i18n.__("You won't be able to revert this!","integrate-google-drive"),icon:"warning",showCancelButton:!0,confirmButtonText:wp.i18n.__("Yes, remove it!","integrate-google-drive"),reverseButtons:!0,showLoaderOnConfirm:!0,customClass:{container:"igd-swal"},preConfirm:function(){var e=n(t).closest(".igd-account-item").data("id");return wp.ajax.post("igd_delete_account",{id:e,nonce:igd.nonce})}}).then((function(e){e.value&&(n(t).closest(".igd-account-item").remove(),Swal.fire({title:wp.i18n.__("Removed!","integrate-google-drive"),text:wp.i18n.__("Account has been removed.","integrate-google-drive"),icon:"success",showConfirmButton:!1,timer:1500,toast:!0}))}))},handleVideoSelector:function(t){t.preventDefault();var e=n(this);Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"igd-swal igd-module-builder-modal-container"},didOpen:function(t){ReactDOM.render(React.createElement(o,{initData:{},onUpdate:function(t){var n=t.folders,o=void 0===n?[]:n,i=t.allowEmbedPlayer,d=void 0===i||i;a.addVideo(e,o[0],d?"embed":"direct"),Swal.close()},onClose:function(){return Swal.close()},isLMS:"tutor"}),document.getElementById("igd-select-files"))},willClose:function(t){ReactDOM.unmountComponentAtNode(document.getElementById("igd-select-files"))}})},addVideo:function(t,n,o){var a=n.id,i=n.accountId,d="".concat(igd.homeUrl,"/?igd_stream=1&id=").concat(a,"&account_id=").concat(i,"&ignore_limit=1");if("embed"===o){var c=e(JSON.stringify({id:a,accountId:i}));d="".concat(igd.homeUrl,"/?direct_file=").concat(c)}var r=document.querySelector('textarea[name="videoUrl"]');if(r){var u=r.value;r.value=d;var l=r._valueTracker;l&&l.setValue(u);var s=new Event("input",{bubbles:!0});r.dispatchEvent(s)}var m=document.querySelector('button[data-cy="submit-url"]');m&&m.click()},handleAttachmentSelection:function(t){t.preventDefault();var e=n(this);Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap igd-tutor-attachment-modal"></div>',showConfirmButton:!1,customClass:{container:"igd-swal igd-module-builder-modal-container"},didOpen:function(t){ReactDOM.render(React.createElement(o,{initData:{},onUpdate:function(t){Swal.close();var n=t.folders,o=(void 0===n?[]:n).map((function(t){return{id:t.id,accountId:t.accountId,name:t.name,size:t.size}})),i=e.closest(".tutor_lesson_modal_form");a.addAttachment(i,o)},onClose:function(){return Swal.close()},isSelectFiles:!0}),document.getElementById("igd-select-files"))},willClose:function(t){ReactDOM.unmountComponentAtNode(document.getElementById("igd-select-files"))}})},initAttachments:function(){var t=n(".tutor_lesson_modal_form"),e=t.find('input[type="hidden"][name^="igd_tutor_attachments"]'),o=[];e.each((function(){var t=n(this),e=t.attr("name").match(/^igd_tutor_attachments\[(.+?)\]\[(.+?)\]$/);if(e){var a=e[1],i=e[2],d=o.find((function(t){return t.id===a}));d||(d={id:a},o.push(d)),d[i]=t.val()}})),o.length&&a.addAttachment(t,o,!1)},addAttachment:function(e,o){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i='<div class="tutor-col-lg-6 tutor-col-xl-4 tutor-mb-16 igd-tutor-attachment" data-id="">\n    <div class="tutor-card">\n     <div class="tutor-card-body">\n      <div class="tutor-row tutor-align-center">\n       <div class="tutor-col tutor-overflow-hidden">\n       <i class="tutor-icon-brand-google-drive tutor-color-primary"></i>\n        <div class="tutor-fs-6 tutor-fw-medium tutor-color-black tutor-text-ellipsis tutor-mb-4 attachment-name"></div>\n        <div class="tutor-fs-7 tutor-color-muted">'.concat(wp.i18n.__("Size:","integrate-google-drive"),'  <span class="attachment-size"></span></div>\n       </div>\n\n       <div class="tutor-col-auto">\n        <span class="tutor-igd-delete-attachment tutor-iconic-btn tutor-iconic-btn-secondary" role="button">\n         <span class="tutor-icon-times" aria-hidden="true"></span>\n        </span>\n       </div>\n      </div>\n     </div>\n    </div>\n   </div>'),d=e.find(".tutor-attachment-cards");o.forEach((function(o){var c=o.id,r=o.accountId,u=o.name,l=o.size,s=n(i);if(s.attr("data-id",c),s.find(".attachment-name").text(u),s.find(".attachment-size").text(t(o.size)),d.append(s),a){var m=n('<input type="hidden" name="igd_tutor_attachments['.concat(c,'][id]" value="').concat(c,'">')),v=n('<input type="hidden" name="igd_tutor_attachments['.concat(c,'][accountId]" value="').concat(r,'">')),g=n('<input type="hidden" name="igd_tutor_attachments['.concat(c,'][name]" value="').concat(u,'">')),h=n('<input type="hidden" name="igd_tutor_attachments['.concat(c,'][size]" value="').concat(l,'">'));e.append(m,v,g,h)}}))},deleteAttachment:function(t){t.preventDefault();var e=n(this).closest(".tutor-col-lg-6"),o=e.data("id"),a=e.closest(".tutor_lesson_modal_form");a.find('input[name="igd_tutor_attachments['.concat(o,'][id]"]')).remove(),a.find('input[name="igd_tutor_attachments['.concat(o,'][accountId]"]')).remove(),a.find('input[name="igd_tutor_attachments['.concat(o,'][name]"]')).remove(),a.find('input[name="igd_tutor_attachments['.concat(o,'][size]"]')).remove(),e.remove()}},n(document).ready(a.init)})();